本文由 简悦 SimpRead 转码， 原文地址 mp.weixin.qq.com

（给 ImportNew 加星标，提高 Java 技能）

作者：饭谈编程 / 稀饭下雪（本文系作者投稿）

在实际研发中，Spring 是我们经常会使用的框架，毕竟它们太火了，也因此 Spring 相关的知识点也是面试必问点，今天我们就大话 Aop。

特地在周末推文，因为该篇文章阅读起来还是比较轻松诙谐的，当然了，更主要的是周末的我也在充电学习，希望有追求的朋友们也尽量不要放过周末时间，适当充电，为了走上人生巅峰，迎娶白富美。【话说有没有白富美介绍 (o≖◡≖)】

接下来，直接进入正文。

为什么要有 Aop

我们都知道 Java 是一种面向对象编程【也就是 OOP】的语言，不得不说面向对象编程是一种及其优秀的设计，但是任何语言都无法十全十美，对于 OOP 语言来说，当需要为部分对象引入公共部分的时候，OOP 就会引入大量的重复代码【这些代码我们可以称之为横切代码】。

而这也是 Aop 出现的原因，没错，Aop 就是被设计出来弥补 OOP 短板的。Aop 便是将这些横切代码封装到一个可重用模块中，继而降低模块间的耦合度，这样也有利于后面维护。

Aop 是什么东西

学过 Spring 的都知道，Spring 内比较核心的功能便是 Ioc 和 Aop，Ioc 的主要作用是应用对象之间的解耦，而 Aop 则可以实现横切代码【如权限、日志等】与他们绑定的对象之间的解耦。

举个浅显易懂的小栗子，在用户调用很多接口的地方，我们都需要做权限认证，判断用户是否有调用该接口的权限，如果每个接口都要自己去做类似的处理，未免有点 sb 了，也不够装 x，因此 Aop 就可以派上用场了，将这些处理的代码放到切片中，定义一下切片、连接点和通知，刷刷刷跑起来就 ok 了。

想要了解 Aop，就要先理解以下几个术语，如 PointCut、Advice、JoinPoint。接下来尽量用白话文描述下。

PointCut【切点】 其实切点的概念很好理解，你想要去切某个东西之前总得先知道要在哪里切入是吧，切点格式如下：execution(* com.nuofankj.springdemo.aop.Service.(..)) 可以看出来，格式使用了正常表达式来定义那个范围内的类、那些接口会被当成切点，简单明了。

Advice Advice 行内很多人都定义成了通知，但是我总觉得有点勉强。所谓的 Advice 其实就是定义了 Aop 何时被调用，确实有种通知的感觉，何时调用其实也不过以下几种：

- Before 在方法被调用之前调用
- After 在方法完成之后调用
- After-returning 在方法成功执行之后调用
- After-throwing 在方法抛出异常之后调用
- Around 在被通知的方法调用之前和调用之后调用

JoinPoint【连接点】 JoinPoint 连接点，其实很好理解，上面又有通知、又有切点，那和具体业务的连接点又是什么呢？没错，其实就是对应业务的方法对象，因为我们在横切代码中是有可能需要用到具体方法中的具体数据的，而连接点便可以做到这一点。

给出一个 Aop 在实际中的应用场景

先给出两个业务内的接口，一个是聊天，一个是购买东西 





接下来该给出说了那么久的切片了 



可以从中看到 PointCut【切点】是

    execution(* com.nuofankj.springdemo.aop.Service.(..))
    

Advice 是

    Before
    

JoinPoint【连接点】是

    MethodSignature signature = (MethodSignature) joinPoint.getSignature(); Method method = signature.getMethod();
    

代码浅显易懂，其实就是将 ChatService 和 BuyService 里边给 userId 做权限校验的逻辑抽出来做成切片。

那么如何拿到具体业务方法内的具体参数呢？这里是定义了一个新的注解 



作用可以直接看注释，使用地方如下 



可以看到对应接口使用了 AuthPermission 的注解，而取出的地方在于



是的，这样便可以取出来对应的接口传递的 userId 具体是什么了，而校验逻辑可以自己处理。

送佛送到西，不对，撸码撸整套，接下来给出运行的主类



可以看到，上面有一个接口传递的 userId 是 1，另一个是 123，而上面权限认证只有 1 才说通过，否则会抛出异常。

运行结果如下 



运行结果可想而知，1 的通过验证，123 的失败。

Aop 的原理解析  

关于原理解析，由于大家都不喜欢看篇幅太长的文章，因此打算拆分成两篇进行，下篇文章会对 Aop 的原理和设计思想进行解析，有兴趣的朋友可以关注一下。

推荐阅读

（点击标题可跳转阅读）

Spring AOP 的实现原理

Spring AOP 的实现机制  

手把手教你用 Java 实现 AOP  

看完本文有收获？请转发分享给更多人

关注「ImportNew」，提升 Java 技能



好文章，我在看❤️
